<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Learning To Rank Library: Composition of algorithms</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Learning To Rank Library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>About</span></a></li>
      <li><a href="_doc_contents.html"><span>Documentation</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="headertitle">
<div class="title">Composition of algorithms </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#TutorialCompositionWhatIs">What is composition?</a><ul><li class="level2"><a href="#TutorialCompositionScorer">Composition Scorer</a></li>
<li class="level2"><a href="#TutorialCompositionScorerList">List of main CompositionScorers</a></li>
</ul>
</li>
<li class="level1"><a href="#TutorialCompositionLearner">Composition Learner</a><ul><li class="level2"><a href="#TutorialCompositionLearningProcess">Learning process</a></li>
</ul>
</li>
<li class="level1"><a href="#TutorialCompositionExamples">Examples</a><ul><li class="level2"><a href="#TutorialCompositionRSM">RSM</a></li>
<li class="level2"><a href="#TutorialCompositionAdaBoost">Classic AdaBoost</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="TutorialCompositionWhatIs"></a>
What is composition?</h2>
<p>In LTR one deals with scorers, which are simply functions over objects. Each scorer is a result of work of a particular learner on a dataset (although one can create a scorer directly for testing purposes).</p>
<p>So, assume we have learned several different learners on the same dataset and receive some scorers. Part of these scorers is good on some data elements, and another part is good on another elements. And the question is: could we combine these scorers to produce a better one?</p>
<h3><a class="anchor" id="TutorialCompositionScorer"></a>
Composition Scorer</h3>
<p>The class that represents the combination of scorers (which usually are called weak scorers) is CompositionScorer. It holds weak scorers with their weights, but does not specify the way they are combined - it is determined in CompositionScorer's inheritors.</p>
<h3><a class="anchor" id="TutorialCompositionScorerList"></a>
List of main CompositionScorers</h3>
<table class="doxtable">
<tr>
<th>CompositionScorer </th><th>Description</th></tr>
<tr>
<td>LinearCompositionScorer </td><td>Scores as weighted average of weak scorers </td></tr>
<tr>
<td>MaxWeightCompositionScorer </td><td>Scores as the weak scorer with the max weight </td></tr>
<tr>
<td>MedianCompositionScorer </td><td>Scores as weighted median of weak scorers </td></tr>
</table>
<h2><a class="anchor" id="TutorialCompositionLearner"></a>
Composition Learner</h2>
<p>As far as LTR has composition scorers, it has a learner for them, a composition learner. How does it work?</p>
<p>First, a composition learner must be able to produce weak scorers to tie them up into a composition one, so one of learner's parameters is a weak learner.</p>
<p>Second, the weights in composition scorer need to be setted, and the class CompositionScorerWeightsUpdater is responsible for this.</p>
<p>Third, it is a good idea to learn a weak scorer, paying attention on hard (for previous scorers) data elements. I. e. the weight distribution over data elements is new for learning a new weak scorer, and LTR has the DataSetWeightsUpdater class for such a work.</p>
<h3><a class="anchor" id="TutorialCompositionLearningProcess"></a>
Learning process</h3>
<p>To use a composition learner one should create it and specify weak learner, CompositionScorerWeightsUpdater, DataSetWeightsUpdater, the type of CompositionScorer which the learner is supposed to create, and the number of iterations. Note that some CompositionScorerWeightsUpdaters may not work properly with some CompositionScorer types, for example, CompositionScorerWeightsUpdater that implements the gradient boosting may require from CompositionScorer type to have a gradient method.</p>
<p>Composition learner works as follows:</p>
<ul>
<li>sets equal weights to the dataset</li>
<li>repeats (as many times as is setted in parameters)<ul>
<li>learns the weak learner on the dataset with current weights, and appends the resulted weak scorer to the composition one (with 1.0 weight)</li>
<li>updates the weights of the composition scorer</li>
<li>updates the weights of the dataset</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="TutorialCompositionExamples"></a>
Examples</h2>
<h3><a class="anchor" id="TutorialCompositionRSM"></a>
RSM</h3>
<p>This is an example of implementing RSM (random subspace method, see <a href="http://en.wikipedia.org/wiki/Random_subspace_method">http://en.wikipedia.org/wiki/Random_subspace_method</a>) with the linear composition learner. Default DataSetWeightsUpdater and CompositionScorerWeightsUpdater do nothing.</p>
<table class="doxtable">
<tr>
<th>Example: Random Subspace Method </th><th>Output:</th></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="preprocessor">#include &quot;<a class="code" href="object_8h.html">ltr/data/object.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="data__set_8h.html">ltr/data/data_set.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="composition__learner_8h.html">ltr/learners/composition_learner/composition_learner.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="composition__scorer_8h.html">ltr/scorers/composition_scorers/composition_scorer.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="abs__error_8h.html">ltr/measures/abs_error.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="feature__random__sampler__learner_8h.html">ltr/feature_converters/feature_random_sampler_learner.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="best__feature__learner_8h.html">ltr/learners/best_feature_learner/best_feature_learner.h</a>&quot;</span>

<span class="keyword">using</span> <a class="code" href="classltr_1_1composition_1_1_composition_learner.html" title="Learner, wich uses other learner (weak learner), produces with it different scorers and tie them into...">ltr::composition::CompositionLearner</a>;
<span class="keyword">using</span> <a class="code" href="classltr_1_1composition_1_1_composition_scorer.html">ltr::composition::CompositionScorer</a>;
<span class="keyword">using</span> <a class="code" href="classltr_1_1_object.html" title="Base class for storing information in a Dataset. An object consist of feature vector and meta informa...">ltr::Object</a>;
<span class="keyword">using</span> <a class="code" href="classltr_1_1_abs_error.html">ltr::AbsError</a>;
<span class="keyword">using</span> <a class="code" href="classltr_1_1_feature_random_sampler_learner.html" title="Produces FeatureSampler with random indices.">ltr::FeatureRandomSamplerLearner</a>;
<span class="keyword">using</span> <a class="code" href="classltr_1_1_best_feature_learner.html">ltr::BestFeatureLearner</a>;

<span class="keywordtype">int</span> <a class="code" href="generator_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {
  srand(14);

  DataSet&lt;Object&gt; dataset(3); <span class="comment">// dataset with 3 features</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 20; ++i) { <span class="comment">// 20 elements</span>
    Object current;
    current &lt;&lt; rand() &lt;&lt; rand() &lt;&lt; rand(); <span class="comment">// random features</span>
    current.set_actual_label(rand()); <span class="comment">// random labels</span>
    dataset &lt;&lt; current;
  }

  <span class="comment">// by default composition learner is linear</span>
  CompositionLearner&lt;Object&gt; linear_composition_learner;

  <a class="code" href="classltr_1_1_measure.html#a6a7879699e2e550f40ecae5cb3f1397d">AbsError::Ptr</a> abs_error(<span class="keyword">new</span> AbsError); <span class="comment">// ::Ptr means a shared pointer wherever in LTR</span>

  FeatureRandomSamplerLearner&lt;Object&gt;::Ptr rsm(<span class="keyword">new</span> FeatureRandomSamplerLearner&lt;Object&gt;);
  BestFeatureLearner&lt;Object&gt;::Ptr best_feature_learner(<span class="keyword">new</span> BestFeatureLearner&lt;Object&gt;(abs_error));
  best_feature_learner-&gt;add_feature_converter_learner(rsm);

  linear_composition_learner.set_weak_learner(best_feature_learner);

  linear_composition_learner.learn(dataset);
  CompositionScorer::Ptr linear_composition_scorer = linear_composition_learner.makeSpecific();

  std::cout &lt;&lt; *linear_composition_scorer;
}
</pre></div> </td><td><div class="fragment"><pre class="fragment">CompositionScorer, including:
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [0] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [0] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [0] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [0] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [1] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [0] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [2] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [2] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [2] [1]
  Scorer, which takes feature no. 0, initially applies 1 feature converters:
[0] Feature sampler with indices: [1] [1]
, has no feature converters
</pre></div> </td></tr>
</table>
<h3><a class="anchor" id="TutorialCompositionAdaBoost"></a>
Classic AdaBoost</h3>
<p>This example represents a classic AdaBoost composition algorithm (see <a href="http://www.robots.ox.ac.uk/~az/lectures/cv/adaboost_matas.pdf">http://www.robots.ox.ac.uk/~az/lectures/cv/adaboost_matas.pdf</a>) on the best feature learner.</p>
<div class="fragment"><pre class="fragment">CompositionLearner&lt;Object, LinearCompositionScorer&gt; linear_composition_learner(5); <span class="comment">// 5 is the nunber of iterations</span>

<a class="code" href="classltr_1_1_measure.html#a6a7879699e2e550f40ecae5cb3f1397d">BinaryClassificationMargin::Ptr</a> binary_classification_margin(<span class="keyword">new</span> BinaryClassificationMargin);
<a class="code" href="classltr_1_1_measure.html#a6a7879699e2e550f40ecae5cb3f1397d">BinaryClassificationAccuracy::Ptr</a> binary_classification_accuracy(<span class="keyword">new</span> BinaryClassificationAccuracy);

AdaRankScorerWeightsUpdater&lt;Object, LinearCompositionScorer&gt;::Ptr
  ada_rank_scorer_weights_updater(<span class="keyword">new</span> AdaRankScorerWeightsUpdater&lt;Object, LinearCompositionScorer&gt;);
ada_rank_scorer_weights_updater-&gt;set_measure(binary_classification_accuracy); <span class="comment">// note that measure for AdaRankScorerWeightsUpdater must be bounded</span>
linear_composition_learner.set_composition_scorer_weights_updater(ada_rank_scorer_weights_updater);

AdaBoostDataSetWeightsUpdater&lt;Object&gt;::Ptr
  ada_boost_data_set_weights_updater(<span class="keyword">new</span> AdaBoostDataSetWeightsUpdater&lt;Object&gt;);
ada_boost_data_set_weights_updater-&gt;set_measure(binary_classification_margin);
linear_composition_learner.set_data_set_weights_updater(ada_boost_data_set_weights_updater);

BestFeatureLearner&lt;Object&gt;::Ptr bf_learner(<span class="keyword">new</span> BestFeatureLearner&lt;Object&gt;(binary_classification_accuracy));
linear_composition_learner.set_weak_learner(bf_learner);

linear_composition_learner.learn(data);
LinearCompositionScorer::Ptr linear_composition_scorer = linear_composition_learner.makeSpecific();

std::cout &lt;&lt; *linear_composition_scorer;
</pre></div><p>Also, the very same thing can be done in a shorter way:</p>
<div class="fragment"><pre class="fragment">AdaBoostLearner ada_learner(5);

<a class="code" href="classltr_1_1_measure.html#a6a7879699e2e550f40ecae5cb3f1397d">BinaryClassificationAccuracy::Ptr</a> binary_classification_accuracy(<span class="keyword">new</span> BinaryClassificationAccuracy);
BestFeatureLearner&lt;Object&gt;::Ptr bf_learner(<span class="keyword">new</span> BestFeatureLearner&lt;Object&gt;(binary_classification_accuracy));
ada_learner.set_weak_learner(bf_learner);

ada_learner.learn(data);
LinearCompositionScorer::Ptr ada_scorer = ada_learner.makeSpecific();

std::cout &lt;&lt; *ada_scorer;
</pre></div> </div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Dec 18 2012 16:58:24 for Learning To Rank Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
